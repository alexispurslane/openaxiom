<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ title }} - OpenAxiom TTRPG</title>
    <link rel="stylesheet" href="/static/style.css">
    {% block head %}{% endblock %}
</head>
<body>
    <header>
        <nav>
            <ul>
                {% for file, file_title in html_files_with_titles %}
                    {% if file == current_file %}
                        <li><strong>{{ file_title }}</strong></li>
                    {% else %}
                        <li><a href="/{{ file }}">{{ file_title }}</a></li>
                    {% endif %}
                {% endfor %}
                <li>
                    <button id="printButton" onclick="printAllPages()">Print Manual</button>
                </li>
                <li>
                    {% include 'search.html' %}
                </li>
            </ul>
        </nav>
    </header>
    
    <main>
        {% block content %}{% endblock %}
    </main>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        const socket = io();
        socket.on('reload', function(data) {
            location.reload();
        });
        
        // Function to print all pages in order
        function printAllPages() {
            // Show loading indicator
            const printButton = document.getElementById('printButton');
            const originalText = printButton.textContent;
            printButton.textContent = 'Generating PDF...';
            printButton.disabled = true;
            
            // Call the server endpoint to generate and download the PDF
            fetch('/api/print')
                .then(response => {
                    if (response.ok) {
                        return response.blob();
                    } else {
                        throw new Error('Failed to generate PDF');
                    }
                })
                .then(blob => {
                    // Create download link
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'openaxiom_manual.pdf';
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    window.URL.revokeObjectURL(url);
                    
                    // Restore button
                    printButton.textContent = originalText;
                    printButton.disabled = false;
                })
                .catch(error => {
                    console.error('Error generating PDF:', error);
                    alert('Error generating PDF. Please try again.');
                    // Restore button
                    printButton.textContent = originalText;
                    printButton.disabled = false;
                });
        }
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
